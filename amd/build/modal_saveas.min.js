/**
 * Contain the logic for the add save as modal.
 *
 * @module    mod_onlyofficeeditor/modal_saveas
 * @copyright  2022 Ascensio System SIA <integration@onlyoffice.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 **/
define("mod_onlyofficeeditor/modal_saveas",["jquery","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/templates"],(function($,Notification,CustomEvents,Modal,ModalRegistry,Templates){var displayNotification=function(error,type){require(["core/notification"],(function(notification){require(["core/str"],(function(str){var errorIsAvailable=str.get_string(error,"onlyofficeeditor");$.when(errorIsAvailable).done((function(localizedStr){notification.addNotification({message:localizedStr,type:type})}))}))}))},SELECTORS_LOADING_ICON_CONTAINER='[data-region="overlay-icon-container"]',SELECTORS_SECTION=".onlyofficeeditor-saveas-section",SELECTORS_BUTTON="#onlyofficeeditor-saveas-button",SELECTORS_CONTAINER=".container",ModalSaveas=function(root){Modal.call(this,root),this.selectedSection=null,this.saveAsData=null,this.CMID=null,this.courseid=null};return ModalSaveas.TYPE="mod_onlyofficeeditor-modal_saveas",(ModalSaveas.prototype=Object.create(Modal.prototype)).constructor=ModalSaveas,ModalSaveas.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this);var modal=this;this.getModal().on("click",SELECTORS_SECTION,(function(e){var selected=modal.selectedSection;null!==selected&&modal.getBody().find("#saveas-section-"+selected)[0].classList.remove("onlyofficeeditor-saveas-section-selected");modal.getFooter().find(SELECTORS_BUTTON)[0].removeAttribute("disabled"),e.target.classList.add("onlyofficeeditor-saveas-section-selected"),modal.selectedSection=parseInt(e.target.id.split("-")[2])})).bind(this),this.getModal().on("click",SELECTORS_BUTTON,(function(){modal.saveAsData.section=modal.selectedSection,$.ajax(M.cfg.wwwroot+"/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=saveas&cmid=".concat(modal.CMID),{type:"POST",dataType:"json",data:modal.saveAsData}).done((()=>{displayNotification("saveassuccess","success")})).fail((()=>{displayNotification("saveaserror","error")})).always((()=>{modal.hide()}))})).bind(this)},ModalSaveas.prototype.renderSections=function(body,cmid,courseid){var modal=this;!function(body){body.find(SELECTORS_LOADING_ICON_CONTAINER).removeClass("hidden")}(body),$.ajax(M.cfg.wwwroot+"/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=sections&cmid=".concat(cmid),{type:"GET",dataType:"json",data:{courseid:courseid}}).done((response=>{var sections=response.sections;Templates.render("mod_onlyofficeeditor/modal_saveas_sections_list",{sections:sections}).then(((html,js)=>{var container=body.find(SELECTORS_CONTAINER)[0];Templates.replaceNode(container,html,js)})).always((()=>{!function(body){body.find(SELECTORS_LOADING_ICON_CONTAINER).addClass("hidden")}(body)}))})).fail((()=>{modal.hide(),displayNotification("saveaserror","error")}))},ModalSaveas.prototype.show=function(){Modal.prototype.show.call(this),null!==this.selectedSection&&(this.selectedSection=null),this.getFooter().find(SELECTORS_BUTTON)[0].setAttribute("disabled","")},ModalRegistry.get(ModalSaveas.TYPE)||ModalRegistry.register(ModalSaveas.TYPE,ModalSaveas,"mod_onlyofficeeditor/modal_saveas"),ModalSaveas}));

//# sourceMappingURL=modal_saveas.min.js.map