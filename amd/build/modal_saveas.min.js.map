{"version":3,"file":"modal_saveas.min.js","sources":["../src/modal_saveas.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for the add save as modal.\n *\n * @module    mod_onlyofficeeditor/modal_saveas\n * @copyright  2024 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery', 'core/modal', 'core/templates', 'core/str'],\n    function($, Modal, Templates, Str) {\n\n        var displayNotification = function(error, type) {\n            require(['core/notification'], function(notification) {\n                require(['core/str'], function(str) {\n                    var errorIsAvailable = str.get_string(error, 'onlyofficeeditor');\n                    $.when(errorIsAvailable).done(function(localizedStr) {\n                        notification.addNotification({\n                            message: localizedStr,\n                            type: type\n                        });\n                    });\n                });\n            });\n        };\n\n        const SaveAsDialog = Object;\n\n        SaveAsDialog.modal = null;\n\n        SaveAsDialog.build = async (cmid, courseid, saveAsData) => {\n            var self = this;\n\n            var stringkeys = [\n                {\n                    key: 'saveastitle',\n                    component: 'mod_onlyofficeeditor'\n                }\n            ];\n\n            Str.get_strings(stringkeys).then(async([title]) => {\n                this.modal = await Modal.create({\n                    title: title,\n                    show: true\n                });\n\n                $.ajax(M.cfg.wwwroot + `/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=sections&cmid=${cmid}`, {\n                    type: 'GET',\n                    dataType: 'json',\n                    data: {courseid: courseid}\n                }).done((response) => {\n                    var sections = response.sections;\n\n                    var body = Templates.render('mod_onlyofficeeditor/modal_saveas_sections_list', {sections: sections});\n                    var footer = Templates.render('mod_onlyofficeeditor/modal_saveas_footer');\n\n                    self.modal.setBody(body);\n                    self.modal.setFooter(footer);\n\n                    self.modal.getRoot().on('click', SELECTORS.SECTION, (e) => {\n                        var selected = self.modal.selectedSection;\n                        if (selected !== undefined) {\n                            var previousSection = self.modal.getBody().find('#saveas-section-' + selected)[0];\n                            previousSection.classList.remove('onlyofficeeditor-saveas-section-selected');\n                        }\n                        var button = self.modal.getFooter().find(SELECTORS.BUTTON)[0];\n                        button.removeAttribute('disabled');\n                        e.target.classList.add('onlyofficeeditor-saveas-section-selected');\n                        self.modal.selectedSection = parseInt(e.target.id.split('-')[2]);\n                    });\n\n                    self.modal.getRoot().on('click', SELECTORS.BUTTON, () => {\n                        saveAsData.section = self.modal.selectedSection;\n                        $.ajax(M.cfg.wwwroot +\n                            `/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=saveas&cmid=${cmid}`, {\n                            type: 'POST',\n                            dataType: 'json',\n                            data: saveAsData,\n                        }).done(() => {\n                            displayNotification('saveassuccess', 'success');\n                        }).fail(() => {\n                            displayNotification('saveaserror', 'error');\n                        }).always(() => {\n                            self.modal.hide();\n                        });\n                    });\n\n                }).fail(() => {\n                    displayNotification('saveaserror', 'error');\n                });\n            });\n        };\n\n        var SELECTORS = {\n            SECTION: '.onlyofficeeditor-saveas-section',\n            BUTTON: '#onlyofficeeditor-saveas-button'\n        };\n\n        return SaveAsDialog;\n    });\n"],"names":["define","$","Modal","Templates","Str","displayNotification","error","type","require","notification","str","errorIsAvailable","get_string","when","done","localizedStr","addNotification","message","SaveAsDialog","Object","modal","build","async","cmid","courseid","saveAsData","self","this","get_strings","key","component","then","title","create","show","ajax","M","cfg","wwwroot","dataType","data","response","sections","body","render","footer","setBody","setFooter","getRoot","on","SELECTORS","SECTION","e","selected","selectedSection","undefined","getBody","find","classList","remove","getFooter","BUTTON","removeAttribute","target","add","parseInt","id","split","section","fail","always","hide"],"mappings":";;;;;;;AAsBAA,2CAAO,CAAC,SAAU,aAAc,iBAAkB,aAC9C,SAASC,EAAGC,MAAOC,UAAWC,SAEtBC,oBAAsB,SAASC,MAAOC,MACtCC,QAAQ,CAAC,sBAAsB,SAASC,cACpCD,QAAQ,CAAC,aAAa,SAASE,SACvBC,iBAAmBD,IAAIE,WAAWN,MAAO,oBAC7CL,EAAEY,KAAKF,kBAAkBG,MAAK,SAASC,cACnCN,aAAaO,gBAAgB,CACzBC,QAASF,aACTR,KAAMA,uBAOpBW,aAAeC,OAErBD,aAAaE,MAAQ,KAErBF,aAAaG,MAAQC,MAAOC,KAAMC,SAAUC,kBACpCC,KAAOC,KASXvB,IAAIwB,YAPa,CACb,CACIC,IAAK,cACLC,UAAW,0BAISC,MAAKT,MAAAA,WAAOU,iBAC/BZ,YAAclB,MAAM+B,OAAO,CAC5BD,MAAOA,MACPE,MAAM,IAGVjC,EAAEkC,KAAKC,EAAEC,IAAIC,sFAAiFf,MAAQ,CAClGhB,KAAM,MACNgC,SAAU,OACVC,KAAM,CAAChB,SAAUA,YAClBV,MAAM2B,eACDC,SAAWD,SAASC,SAEpBC,KAAOxC,UAAUyC,OAAO,kDAAmD,CAACF,SAAUA,WACtFG,OAAS1C,UAAUyC,OAAO,4CAE9BlB,KAAKN,MAAM0B,QAAQH,MACnBjB,KAAKN,MAAM2B,UAAUF,QAErBnB,KAAKN,MAAM4B,UAAUC,GAAG,QAASC,UAAUC,SAAUC,QAC7CC,SAAW3B,KAAKN,MAAMkC,qBACTC,IAAbF,UACsB3B,KAAKN,MAAMoC,UAAUC,KAAK,mBAAqBJ,UAAU,GAC/DK,UAAUC,OAAO,4CAExBjC,KAAKN,MAAMwC,YAAYH,KAAKP,UAAUW,QAAQ,GACpDC,gBAAgB,YACvBV,EAAEW,OAAOL,UAAUM,IAAI,4CACvBtC,KAAKN,MAAMkC,gBAAkBW,SAASb,EAAEW,OAAOG,GAAGC,MAAM,KAAK,OAGjEzC,KAAKN,MAAM4B,UAAUC,GAAG,QAASC,UAAUW,QAAQ,KAC/CpC,WAAW2C,QAAU1C,KAAKN,MAAMkC,gBAChCrD,EAAEkC,KAAKC,EAAEC,IAAIC,oFAC4Df,MAAQ,CAC7EhB,KAAM,OACNgC,SAAU,OACVC,KAAMf,aACPX,MAAK,KACJT,oBAAoB,gBAAiB,cACtCgE,MAAK,KACJhE,oBAAoB,cAAe,YACpCiE,QAAO,KACN5C,KAAKN,MAAMmD,gBAIpBF,MAAK,KACJhE,oBAAoB,cAAe,oBAK3C6C,UAAY,CACZC,QAAS,mCACTU,OAAQ,0CAGL3C"}